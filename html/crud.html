<!DOCTYPE html>
<html lang="en">

<head>
    <title>Blog Posts</title>
    <meta charset="UTF-8">
    <meta name="description" content="Blog Posts page of my personal website">
    <meta name="author" content="Jingxian Wang">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <!-- Main content to display on the screen -->
	<h1>Blog!</h1>
	
    <section id="main_post">
        <h2 id="starter">You can add your posts!</h2>
    </section>
	

    <!-- Custom dialogs -->

    <!-- Dialog for creating post -->
    <dialog id="create_post_dialog">
        <p id="create_message"></p>
        <form method="dialog" autocomplete="off">
            <div>
                <label for="post_title">Title: </label>
                <input type="text" id="post_title">
            </div>
            <br>
            <div>
                <label for="post_date">Date: </label>
                <input type="date" id="post_date">
            </div>
            <br>
            <div>
                <label for="post_summary">Summary: </label>
                <textarea id="post_summary"></textarea>
            </div>
            <br>
            <button id="submit_btn" type="submit">Create</button>
            <button id="cancel_btn">Cancel</button>
          </form>
    </dialog>

    <!-- Dialog for editing post -->
    <dialog id="edit_dialog">
        <p id="edit_message"></p>
        <form method="dialog" autocomplete="off">
            <div>
                <label for="edit_post_title">Title: </label>
                <input type="text" id="edit_post_title">
            </div>
            <br>
            <div>
                <label for="edit_post_date">Date: </label>
                <input type="date" id="edit_post_date">
            </div>
            <br>
            <div>
                <label for="edit_post_summary">Summary: </label>
                <textarea id="edit_post_summary"></textarea>
            </div>
            <br>
            <button id="edit_btn" type="submit">Create</button>
            <button id="edit_cancel_btn">Cancel</button>
          </form>
    </dialog>

    <!-- Dialog for ask users' confirmation -->
    <dialog id="custom_confirm_dialog">
        <p id="confirm_message"></p>
        <button id="yes_btn">Yes</button>
        <button id="no_btn">No</button>
    </dialog>

    <!-- Click the button to create the post -->
    <button id="create_btn">Create</button>


    <!-- Javascript -->
    <script type="module">
        import { createPost, customConfirm, editPost } from '/javascripts/blog.js';

        // Click the create button to create the blog post
        document.getElementById('create_btn').addEventListener('click', async () => {
            var result = await createPost("You can write your Blog here!");
            if (Array.isArray(result)) {
                document.getElementById('starter').textContent = ''
                
                var post = document.createElement('article');
                post.innerHTML = `<h2 class="title">${result[0]}</h2>
                                  <p class="date">Date: ${result[1]}</p>
                                  <p class="summary">Summary: ${result[2]}</p>
                                  <button class="delete_btn">Delete</button>
                                  <button class="edit_btn">Edit</button>
                                 `;
                document.getElementById('main_post').appendChild(post);
                
                // console.log(post);
                // console.log(post.firstElementChild.textContent)
                // console.log(post.firstElementChild.nextElementSibling.textContent)
                // console.log(post.firstElementChild.nextElementSibling.textContent.substring(6))
                // console.log(post.firstElementChild.nextElementSibling.nextElementSibling.textContent)
                // console.log(post.firstElementChild.nextElementSibling.nextElementSibling.textContent.substring(9))

                // CLick the delete button to delete the blog post
                post.querySelector('.delete_btn').addEventListener('click', async () => {
                    let answer = await customConfirm('Are you sure you want to delete it?');
                    if (answer) {
                        post.remove(); 
                    }
                });

                
                // Click the edit button to edit the blog post
                post.querySelector('.edit_btn').addEventListener('click', async () => {
                    const update = await editPost("Edit Your Blog Here!", post);
                    // result = update;

                    if(Array.isArray(update)) {
                        post.firstElementChild.textContent = update[0];
                        post.firstElementChild.nextElementSibling.textContent = `Date: ${update[1]}`;
                        post.firstElementChild.nextElementSibling.nextElementSibling.textContent = `Summary: ${update[2]}`;
                        // console.log(post);
                    }
                });
            }
        });
    </script>


    <!-- <footer>
        <p class="footer"> &copy; Jingxian Wang </p>
    </footer> -->
</body>
</html>